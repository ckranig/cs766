For the maximal focus calculation I passed an averaging convolution over each pixel before computing the laplacian. 
I also averaged the outputs at the end.

A window size of 1 seemed to produce the best results.